# Final-desicion_NoFloodWithAI-
Презентация решения к Заданию AIJ
NoFloodWithAI: паводки на реке Амур

Описание задачи.

Участникам соревнования предлагается разработать алгоритм краткосрочного прогнозирования уровней воды  р.  прогнозирования уровней воды р. Амур для следующих населенных пунктов (гидропостов): Джалинда, Благовещенск, Иннокентьевка, Ленинское, Хабаровск, Комсомольск-на-Амуре, Николаевск-на-Амуре на 10 дней вперед.
Река Амур является трансграничной рекой, основная часть бассейна которой находится в пределах Российской Федерации. Для Амура характерна низкая водность в зимний период, небольшие половодья весной и неоднократные резкие подъемы воды во второй половине лета и в начале осени. Маловодные периоды сменяются годами большой воды. В многолетнем режиме водного стока Амура отчётливо выражено чередование периодов пониженной и повышенной водности, каждый продолжительностью 12-17 лет. Амур по оценке гидрологов и исходя из истории наблюдений вошел в очередной период высокой водности в конце 2000-х. Исходя из данной гидрологической закономерности режима Амура, в ближайшие 5-7 лет следует ожидать сложную паводковую обстановку в течении Среднего и Нижнего Амура (наиболее сложная обстановка от слияния р. Сунгари и до Комсомольского района включительно).
Наиболее крупномасштабные наводнения произошли в 2013 и 2019 гг. Причиной наводнений стали тропические циклоны, которые несли теплый влажный воздух, вызывали фронтальные разделы и сильные атмосферные осадки. В 2013 на значительной площади за 2-3 мес. сумма выпавших осадков превысила годовую, а местами и полуторагодовую норму.
В целях минимизации экономического ущерба необходимо создать инструмент для прогнозирования паводковых волн на Амуре и его притоках.

Решение задачи.

За основу было взято baseline решение от организаторов размещенное: https://github.com/sberbank-ai/no_flood_with_ai_aij2020. К имеющимся признакам были добавлены: 
1.	day_temperature_air_90_10 (средняя дневная температура воздуха за последние 90 дней, 10 дней назад) и night_temperature_air_90_10 (средняя ночная температура воздуха за последние 90 дней, 10 дней назад) - наличие весной продолжительных ночных заморозков, сопровождающееся дневными плюсовыми температурами, способствует снижению уровня воды;
2.	количество рассматриваемых лет увеличено до 30 (от past_1_0 до past_30_10) – в резких наводнениях р. Амур во всех источниках отмечается цикл, не превышающий 30 лет.

Так как в дальнейшем использую библиотеку heamy (https://github.com/rushter/heamy), чтобы избежать обучение на данных из будущего, беру данные об уровнях реки от 11 дня (с ts_11 по ts_20). Отсюда получаю признак ts_raise (ts_20/ ts_11), показывающий прирост/снижение уровня воды за последние 10 дней.
Для получения дополнительных признаков использую модель Prophet. В итоге получаем признаки: 'yhat' (уровень воды в реке по данным модели), 'trend' (тренд изменения уровня воды),'daily' (дневные значения уровня воды по данным модели).
Как уже упоминалось, для обучения используем библиотеку heamy, а точнее, одну из схем стекинга – блендинг. В качестве базовых алгоритмов используем CatBoostRegressor и XGBRegressor. Прогнав модели через блендинг в пропорции 20/80 (test/train), получаем метапризнаки, которые подаем на вход метаалгоритму ExtraTreesRegressor после чего получаем ответ.
